# Sox_Settransformer 사용자용 상세 매뉴얼 (USER GUIDE)

---

## 목차 / Table of Contents

1. 프로젝트 소개 (Introduction)
2. 배경 이론 (Background Theory)
3. 전체 파이프라인 한눈에 보기 (Overview Diagram)
4. 실행 환경 준비 (Environment Setup)
5. 단계별 실행 방법 (Step-by-step Usage)
6. 결과 해석 및 실험 확장 (Result Interpretation & Experimentation)
7. 자주 묻는 질문 (FAQ)
8. 참고자료/더 알아보기 (References)

---

## 1. 프로젝트 소개 (Introduction)

### 이 프로그램은 무엇인가요?

- Sox_Settransformer는 WiFi(와이파이) 신호만으로 사람이나 기기의 위치를 예측하는 인공지능 실험 도구입니다.
- 복잡한 센서나 GPS 없이, 주변에 잡히는 여러 WiFi 신호의 정보만으로 "지금 어디에 있는지"를 알아낼 수 있습니다.
- 대용량 데이터(수십~수백만 개의 WiFi 신호 기록)도 빠르고 효율적으로 처리할 수 있습니다.

### 왜 필요한가요?

- 실내(건물 안)에서는 GPS가 잘 잡히지 않거나, 정확도가 떨어집니다.
- WiFi 신호는 거의 모든 실내 공간에서 잡히기 때문에, 위치 추정에 매우 유용합니다.
- 쇼핑몰, 병원, 공항, 박물관 등에서 실내 내비게이션, 사람/자산 위치 추적, 동선 분석 등에 활용할 수 있습니다.

### 실생활/산업 활용 예시

- **실내 내비게이션:** 대형 쇼핑몰에서 "지금 내 위치"를 알려주고, 매장까지 길 안내
- **병원/공항:** 환자, 의료기기, 수하물 등 자산의 실시간 위치 추적
- **스마트 빌딩:** 방문자 동선 분석, 혼잡도 예측, 에너지 절감
- **박물관:** 관람객 위치 기반 오디오 가이드 자동 재생

### 한 줄 요약
> "WiFi 신호만으로 실내 위치를 똑똑하게 예측하는 인공지능 실험실!"

### 쉬운 비유
> 여러 친구가 "나 여기서 신호가 세게 잡혀!"라고 말해주면, 그 의견을 모아 내 위치를 추정하는 것과 비슷합니다.

### 그림/다이어그램 위치
- (여기에 "WiFi 신호 → 위치 예측" 흐름을 보여주는 간단한 그림/다이어그램을 추가할 수 있습니다)

---

## 2. 배경 이론 (Background Theory)

### WiFi 신호란?
- WiFi 신호는 우리가 스마트폰이나 노트북으로 무선 인터넷을 쓸 때 주고받는 전파입니다.
- 각 장소마다 WiFi 신호의 세기와 정보가 다르기 때문에, 신호만 잘 분석해도 "지금 어디에 있는지"를 알 수 있습니다.
- **비유:** WiFi 신호는 마치 여러 개의 무선 라디오 방송국이 내 주변에서 얼마나 크게 들리는지 측정하는 것과 비슷합니다.

### 위치 추정이란?
- 위치 추정은 "지금 내가 어디에 있는지"를 다양한 신호(예: GPS, WiFi, Bluetooth 등)로 알아내는 기술입니다.
- 실내에서는 GPS가 잘 잡히지 않으므로, WiFi 신호가 매우 중요한 역할을 합니다.
- **실생활 예시:** 쇼핑몰에서 내비게이션 앱이 내 위치를 알려주는 것, 박물관에서 오디오 가이드가 자동으로 재생되는 것 등

### 그리드셀(Grid Cell)이란?
- 지도 위를 바둑판처럼 작은 칸(셀)으로 나누고, 각 칸에 번호를 붙여서 위치를 표현하는 방식입니다.
- 예를 들어, 25m x 25m 크기의 셀로 나누면, 내 위치는 "(x=12, y=8)번 셀"처럼 표현됩니다.
- **비유:** 지도 위에 바둑판을 올려놓고, 내가 어느 칸에 있는지 찾는 것과 같습니다.

### 집합(Set) 데이터란? 왜 순서에 무관한가?
- WiFi 신호는 여러 개가 한 번에 잡히는데, 그 순서는 매번 달라질 수 있습니다.
- 중요한 것은 "어떤 신호들이 잡혔는지"이지, "어떤 순서로 잡혔는지"가 아닙니다.
- **비유:** 여러 친구가 동시에 의견을 내면, 그 의견의 순서와 상관없이 전체 의견을 모아 결론을 내리는 것과 같습니다.

### Attention/SetTransformer의 원리
- Attention은 입력 데이터(여러 WiFi 신호) 중에서 중요한 정보에 더 집중해서 처리하는 인공지능 기술입니다.
- SetTransformer는 여러 신호(집합)를 한 번에 받아, 순서에 상관없이 위치를 예측할 수 있게 설계된 모델입니다.
- **비유:** 회의에서 여러 사람이 동시에 의견을 낼 때, 중요한 의견에 더 귀 기울여 결론을 내리는 것과 비슷합니다.
- **[그림 위치]** (여러 WiFi 신호 → Attention → 위치 예측 흐름도)

### HDF5란?
- HDF5는 대용량 데이터를 빠르고 효율적으로 저장/읽기 위한 파일 포맷입니다.
- 수십~수백만 개의 WiFi 신호 데이터를 한 번에 저장하고, 필요한 부분만 빠르게 불러올 수 있습니다.
- **비유:** 수많은 책이 꽂힌 도서관에서, 원하는 책만 빠르게 꺼내 읽는 것과 비슷합니다.

### 병렬 인코딩이란?
- 대용량 데이터를 여러 컴퓨터(코어)가 동시에 나눠서 처리하는 방법입니다.
- 덕분에 데이터가 많아도 빠르게 인코딩(변환)할 수 있습니다.
- **비유:** 여러 명이 동시에 책을 읽고 요약해서, 전체 작업 속도를 높이는 것과 같습니다.

### Reproducibility(재현성)란?
- 같은 설정(config)과 데이터로 실험을 반복하면, 항상 같은 결과가 나오는 것을 의미합니다.
- 실험의 신뢰성과 과학적 검증을 위해 매우 중요합니다.
- **실생활 예시:** 요리 레시피대로 재료와 순서를 정확히 지키면, 누구나 같은 맛을 낼 수 있는 것과 같습니다.

---

## 3. 전체 파이프라인 한눈에 보기 (Overview Diagram)

### 전체 데이터 흐름도

```
[1] 데이터베이스(DB) → [2] 데이터 인코딩(병렬) → [3] HDF5 part 파일 저장
      ↓
[4] part 파일 병합 → [5] 통합 HDF5(features.h5, labels.h5)
      ↓
[6] 모델 학습(DataLoader + SetTransformer)
      ↓
[7] 체크포인트/로그 저장
      ↓
[8] 추론(Inference) 및 평가(Evaluation)
```

> (여기에 실제 파이프라인 흐름을 그림/다이어그램으로 추가할 수 있습니다)

### 각 단계별 역할/입출력/예시 (환경 호환성 강화)

> **1. 데이터베이스**  
>   • **역할:** WiFi 신호 원본 데이터 저장  
>   • **입력:** (없음)  
>   • **출력:** DB row  
>   • **예시:** MariaDB, CSV 등  
>
> **2. 데이터 인코딩**  
>   • **역할:** WiFi 신호를 숫자 벡터로 변환  
>   • **입력:** DB row  
>   • **출력:** feature 벡터  
>   • **예시:** MAC, RSSI 등 인코딩  
>
> **3. HDF5 part 저장**  
>   • **역할:** 인코딩 결과를 임시 파일로 저장  
>   • **입력:** feature/label  
>   • **출력:** part-001_features.h5  
>   • **예시:** 대용량 처리용  
>
> **4. part 병합**  
>   • **역할:** 여러 part 파일을 하나로 합침  
>   • **입력:** part-*.h5  
>   • **출력:** features.h5, labels.h5  
>   • **예시:** 병합 스크립트  
>
> **5. 통합 HDF5**  
>   • **역할:** 학습/추론에 쓸 최종 데이터  
>   • **입력:** (없음)  
>   • **출력:** features.h5, labels.h5  
>   • **예시:** -  
>
> **6. 모델 학습**  
>   • **역할:** SetTransformer로 위치 예측 모델 학습  
>   • **입력:** features.h5, labels.h5  
>   • **출력:** 모델 체크포인트  
>   • **예시:** UniversalTrainer  
>
> **7. 체크포인트/로그**  
>   • **역할:** 학습 중간/최종 결과 저장  
>   • **입력:** (없음)  
>   • **출력:** best_model.pt, log.txt  
>   • **예시:** -  
>
> **8. 추론/평가**  
>   • **역할:** 테스트 데이터 예측/성능 평가  
>   • **입력:** 모델, features.h5  
>   • **출력:** 예측 결과, 평가 리포트  
>   • **예시:** predictions.csv, evaluation_report.json  

### 쉬운 설명/비유
- 전체 파이프라인은 "원재료(데이터)를 준비해서, 요리(인코딩/학습)하고, 완성된 요리(모델)로 맛 평가(추론/평가)까지 하는 과정"과 비슷합니다.
- 각 단계는 공장 생산라인처럼, 앞 단계의 결과를 받아 다음 단계로 넘깁니다.

### 그림/다이어그램 위치
- (여기에 각 단계별 흐름을 한눈에 보여주는 그림/다이어그램을 추가할 수 있습니다)

---

## 4. 실행 환경 준비 (Environment Setup)

### 1. 파이썬 및 필수 라이브러리 설치
- Sox_Settransformer는 Python 3.8 이상에서 동작합니다.
- 필요한 라이브러리는 requirements.txt에 모두 정리되어 있습니다.

**설치 명령어:**
```bash
pip install -r requirements.txt
```
- 설치가 잘 되면, 별다른 에러 메시지 없이 명령 프롬프트가 다시 뜹니다.
- **실전 팁:** Python 가상환경(venv, conda 등)에서 설치하면 여러 프로젝트를 깔끔하게 관리할 수 있습니다.

### 2. 데이터베이스/샘플 데이터 준비
- 실제 WiFi 신호 데이터가 있다면, MariaDB(MySQL 호환) 또는 CSV 파일로 준비하세요.
- 샘플 데이터가 없는 경우, 예시 CSV 파일을 만들어 연습할 수 있습니다.

**샘플 CSV 예시:**
```csv
id,longitude,latitude,mac,rssi,ipcikey,icellid
1,126.998153,37.566629,00:40:5a:af:bc:4a,-65,158_1350_2_0,12345
2,126.998200,37.566700,00:40:5a:af:bc:4b,-70,158_1350_2_1,12346
...
```
- **실전 팁:** 데이터가 너무 많으면, 처음에는 1000개 정도만 추출해서 실험해보세요.

### 3. config 파일 구조와 작성법
- Sox_Settransformer는 모든 실험 설정을 config YAML 파일로 관리합니다.
- config 파일에는 데이터 경로, 인코더/모델 파라미터, 학습 옵션 등이 들어갑니다.

**최소 config 예시:**
```yaml
data:
  db:
    host: localhost
    port: 3306
    user: user
    password: pw
    database: wifi
    table: signals
    id_col: id
    chunk_size: 10000
  encoder:
    type: WiFiMultiFieldEncoder
    params:
      max_mac_count: 32
      max_ipcikey_count: 8
      max_icellid_count: 4
  gridcell:
    level: 5
  x_max: 1000
model:
  name: set_transformer
  task: regression
  params:
    hidden_dim: 256
    num_heads: 4
    num_inds: 32
    num_enc_layers: 2
    num_dec_layers: 2
    dropout: 0.0
training:
  batch_size: 128
  epochs: 50
  optimizer: adam
  lr: 0.001
  seed: 42
  early_stopping: 10
experiment:
  name: wifi_exp001
  output_dir: experiments/wifi_exp001/
```
- **실전 팁:** config 파일을 복사해서 실험별로 이름만 바꿔 사용하면, 여러 실험을 쉽게 비교할 수 있습니다.

### 4. 에러 대처법/FAQ
- **pip install 에러:** Python 버전, 인터넷 연결, 관리자 권한을 확인하세요.
- **DB 연결 에러:** host/port/user/password/database/table 이름이 정확한지, DB 서버가 켜져 있는지 확인하세요.
- **config 에러:** YAML 문법(들여쓰기, 콜론 등) 오류가 없는지, 경로/파라미터가 맞는지 확인하세요.
- **실전 팁:** 에러 메시지를 복사해서 구글/깃허브 이슈에 검색하면 대부분 해결 방법이 나옵니다.

---

## 5. 단계별 실행 방법 (Step-by-step Usage)
- 데이터 인코딩
- part 병합
- 모델 학습
- 추론/평가
- 각 단계별 명령어, 예상 결과, 에러 대처법
- **예시:**
  - "python scripts/encode_data.py ..."
  - "실패시: DB 연결 정보를 다시 확인하세요!"

## 6. 결과 해석 및 실험 확장 (Result Interpretation & Experimentation)

### 1. 예측 결과/평가 리포트 해석법

> **설명:**
> - 모델이 예측한 위치와 실제 위치(label)를 비교해, 얼마나 정확하게 예측했는지 평가합니다.
> - 평가 결과는 evaluation_report.json 파일에 저장됩니다.

**평가 리포트 예시:**
```json
{
  "num_samples": 1000,
  "mae": 2.13,
  "mse": 7.21,
  "grid_accuracy": 0.82
}
```
- **MAE(Mean Absolute Error):** 예측 위치와 실제 위치의 평균 오차(셀 단위). 낮을수록 좋음.
- **MSE(Mean Squared Error):** 오차의 제곱 평균. 낮을수록 좋음.
- **grid_accuracy:** (회귀) 예측 위치가 실제 셀과 완전히 일치한 비율. 1.0에 가까울수록 좋음.
- **accuracy:** (분류) 전체 중 정답을 맞춘 비율. 1.0에 가까울수록 좋음.

> **비유:** MAE가 2.0이면, 평균적으로 실제 위치에서 2칸(셀) 정도 떨어진 곳을 예측했다는 뜻입니다.

### 2. config만 바꿔 다양한 실험 해보기

> **설명:**
> - config 파일의 파라미터(예: 인코더 종류, 모델 구조, 학습 옵션 등)만 바꿔서 다양한 실험을 할 수 있습니다.
> - 예를 들어, dropout 값을 0.0 → 0.2로 바꿔 과적합을 방지하거나, num_heads를 4 → 8로 바꿔 모델 성능을 실험할 수 있습니다.

**실전 팁:**
- config 파일을 복사해서 이름만 바꾼 뒤, 여러 실험을 병렬로 진행해보세요.
- 실험별로 output_dir을 다르게 지정하면 결과가 섞이지 않습니다.

### 3. 새로운 인코더/모델 추가 (비전문가용 안내)

> **설명:**
> - Sox_Settransformer는 인코더/모델을 쉽게 확장할 수 있도록 설계되어 있습니다.
> - 새로운 WiFi 인코딩 방식이나 모델 구조를 추가하고 싶다면, data/encoders/ 또는 models/ 폴더에 새로운 클래스를 만들어 등록하면 됩니다.

**실전 팁:**
- 기존 WiFiMultiFieldEncoder, SetTransformer 코드를 참고해서, 필요한 부분만 바꿔보세요.
- config의 encoder/model type만 바꿔주면, 새로 만든 인코더/모델을 바로 실험에 쓸 수 있습니다.

### 4. 실험 결과 공유/활용
- 평가 리포트, 체크포인트(best_model.pt), 로그 파일 등을 다른 사람과 공유하면, 실험 재현성과 협업이 쉬워집니다.
- 실험 결과를 논문/보고서/프레젠테이션에 활용할 때, config와 평가 리포트를 함께 첨부하면 신뢰도가 높아집니다.

---

## 7. 자주 묻는 질문 (FAQ)
- 에러/실패/환경 문제/결과 해석 등
- **예시:** "HDF5 파일이 안 열려요! → 파일 경로와 권한을 확인하세요."

## 8. 참고자료/더 알아보기 (References)
- WiFi 위치추정, SetTransformer, HDF5 등 쉬운 참고 링크
- **예시:** "유튜브: 'WiFi로 위치 찾기 실험' 검색"

---

> 각 섹션은 초보자도 이해할 수 있도록 쉬운 용어, 비유, 그림, 예시, 실전 팁 위주로 채워나갈 예정입니다.
> 실제 코드/명령어/실험 결과 캡처, 그림/다이어그램 등은 각 섹션별로 차근차근 추가됩니다. 